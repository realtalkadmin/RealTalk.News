new Vue({el:"#vue-scan",data:window.lookseeData,methods:{clearStatuses:function(){var vue=this;this.forEach(this.forms,function(v,k){vue.forms[k].errors={},vue.forms[k].saved=!1})},settingsSubmit:function(){var vue=this;this.clearStatuses(),this.forms.settings.loading=!0,this.formAjax(this.forms.settings,function(r){vue.forms.settings.loading=!1,r.ok&&r.data?(vue.forEach(r.data,function(v,k){vue.forms.settings[k]=v}),vue.forms.settings.saved=!0):r.errors?vue.forms.settings.errors=r.errors:vue.forms.settings.errors.other="The server garbled the last response. :(",vue.scrollTo()})},historySubmit:function(switchSection){var vue=this;this.clearStatuses(),this.forms.history.loading=!0,this.formAjax(this.forms.history,function(r){vue.forms.history.loading=!1,r.ok&&r.data?(r.data.results&&Array.isArray(r.data.results)?vue.history=r.data.results:vue.history=[],(switchSection=parseInt(switchSection,10)||0)&&Vue.nextTick(function(){vue.toggleResult(switchSection)})):vue.forms.history.errors.other="Scan history could not be loaded.",vue.scrollTo()})},abortSubmit:function(){var vue=this;this.clearStatuses(),this.forms.abort.loading=!0,this.formAjax(this.forms.abort,function(r){vue.forms.abort.loading=!1,r.ok&&r.data?r.data.success&&(vue.forms.abort.saved=!0):vue.forms.abort.errors.other="The abort request did not seem to work.",vue.scrollTo()})},fileSubmit:function(){var vue=this;this.clearStatuses(),this.forms.file.loading=!0,this.forms.file.confirming=!1,this.formAjax(this.forms.file,function(r){if(vue.forms.file.loading=!1,r.ok&&r.data){if(r.data.success){if("looksee_ajax_file_view"!==vue.forms.file.action)return"looksee_ajax_file_ignore"===vue.forms.file.action&&(vue.forms.settings.scan.blacklist=r.data.blacklist),vue.historySubmit();vue.file=r.data.file,Vue.nextTick(function(){Prism.highlightAll()})}}else r.errors?vue.forms.file.errors=r.errors:vue.forms.file.errors.other="The server garbled the last response. :(";vue.scrollTo()})},filePreSubmit:function(action,file_path,file_hash){var actions=["delete","fix","ignore","view"];return this.forms.file.loading=!1,this.forms.file.confirming=!1,this.forms.file.action="looksee_ajax_file_"+action,this.forms.file.file_path=file_path,this.forms.file.file_hash=file_hash,this.forms.file.scan_id=this.currentScan.scan_id,this.clearStatuses(),-1!==actions.indexOf(action)&&(this.forms.file.loading=!0,"view"===action?this.fileSubmit():void(this.forms.file.confirming=!0))},scanSubmit:function(){var vue=this;this.clearStatuses(),this.forms.scan.loading=!0,this.formAjax(this.forms.scan,function(r){r.ok&&r.data?(vue.forEach(r.data,function(v,k){vue.forms.scan[k]=v}),"finished"===r.data.status?(vue.forms.scan.loading=!1,vue.historySubmit(vue.forms.scan.scan_id),vue.forms.scan.scan_id=0,vue.forms.scan.progress=0,vue.forms.scan.status="",vue.forms.scan.statusText=""):Vue.nextTick(function(){setTimeout(function(){vue.scanSubmit()},500)})):r.errors&&r.errors.other!==vue.genericAJAXError?(vue.forms.scan.errors=r.errors,vue.forms.scan.loading=!1,vue.forms.abort.aborted=!1,vue.forms.scan.scan_id=0,vue.forms.scan.progress=0,vue.forms.scan.status="",vue.forms.scan.statusText=""):(vue.forms.scan.errors.other="The last operation timed out. We'll try again.",Vue.nextTick(function(){setTimeout(function(){vue.scanSubmit()},500)})),vue.scrollTo()})},toggleModal:function(modal){modal&&modal!==this.modal&&this.modals[modal]?this.modal=modal:this.modal=!1},toggleSection:function(section){"results"!==section?(this.scan_id=0,"history"!==section||history.length||(section="scan")):this.scan_id<=0||!this.currentScan?section="history":this.warning_type="",this.section=section,Vue.nextTick(function(){Prism.highlightAll()})},toggleResult:function(scan_id){this.scan_id=parseInt(scan_id,10)||0;var vue=this;Vue.nextTick(function(){vue.toggleSection("results")})}},computed:{statusIndex:function(){return this.statuses.indexOf(this.forms.scan.statusText)},currentScan:function(){if(this.scan_id=parseInt(this.scan_id,10)||0,this.scan_id<=0||!this.history.length)return this.scan_id=0,!1;var i,current=!1;for(i=0;i<this.history.length;i++)this.history[i].scan_id===this.scan_id&&(current=JSON.parse(JSON.stringify(this.history[i])),i=this.history.length);return current},currentWarnings:function(){if(!this.currentScan||!this.currentScan.results.warnings)return[];if(!this.warning_type||this.currentScan.details.warning_types.length<2)return this.currentScan.details.warnings;for(var warnings=[],i=0;i<this.currentScan.details.warnings.length;i++)this.warning_type===this.currentScan.details.warnings[i].warningText&&warnings.push(this.currentScan.details.warnings[i]);return warnings},slowScans:function(){if(!this.history.length)return!1;var entries=0,elapsedTime=0;for(i=0;i<this.history.length;i++)this.history[i].error||this.history[i].scheduled||(entries++,elapsedTime+=this.history[i].results.scanned/this.history[i].elapsed);return entries>0&&elapsedTime/entries<25}},filters:{relativeTime:function(time){if((time=parseInt(time,10)||0)<=0)return"0s";var y=0,d=0,h=0,m=0,s=time;s-=60*(y=Math.floor(s/60/60/24/365))*60*24*365,s-=60*(d=Math.floor(s/60/60/24))*60*24,s-=60*(h=Math.floor(s/60/60))*60,s-=60*(m=Math.floor(s/60));var out=[];return y>0&&out.push(y+"y"),d>0&&out.push(d+"d"),h>0&&out.push(h+"h"),m>0&&out.push(m+"m"),s>0&&out.push(s+"s"),out.length>3&&out.splice(3),out.join(" ")}},mounted:function(){this.historySubmit(),this.forms.scan.scan_id>0&&this.scanSubmit()}});